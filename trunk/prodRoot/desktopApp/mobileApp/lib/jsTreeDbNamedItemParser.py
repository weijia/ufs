import urllibimport osgWebRoot = 'http://localhost:9901'gWebRoot = 'http://wwjufsdatabase.appspot.com/'# baseDir = 'd:\\tmp\\'# dataDirBase = os.path.join(baseDir,'data')# infoDir = os.path.join(baseDir,'list.txt')#infoDir = 'list.txt'def parseItems(content):    #print content    content = content.decode('utf8')    c = content.split('-->')    r = ''    for i in c:        m = i.split('<!--')        if len(m) < 2:            #No comment            #print m            r += m[0]        else:            #One comment            print m            #print len(m), ''.join(m[0:-1])            r += ''.join(m[0:-1])    #print 'removed comments:',r    r = r.replace('\r','')    r = r.replace('\n','')    l = r.split('</li>')    #print l    items = {}    import re    for i in l:        if i == '':            continue        m1 = re.search('id=\"([0-9a-f\-]+)\"',i)        m2 = re.search('<a href="#">([^<]+)</a>',i)        items[unicode(m1.groups(0)[0])] = unicode(m2.groups(0)[0])        #print m1.groups(0)[0]        #print m2.groups(0)[0]    return itemsdef getItemList(itemAbsPath, tmpPath,username,passwd, webRoot = gWebRoot):    infoPath = os.path.join(tmpPath, 'namedTreeItemList.txt')    print webRoot    urllib.urlretrieve(webRoot+'/apps/tree/jsTreeDbNamedItem.py?id=%s&username=%s&passwd=%s'%(itemAbsPath,username,passwd), infoPath)    f = open(infoPath)    items = parseItems(f.read())    f.close()    return itemsdef saveData(dataId, destFullPath, username, passwd, webRoot = gWebRoot):    print 'Download %s to: %s'%(dataId, destFullPath)    urllib.urlretrieve(webRoot+'/apps/tree/getStorageData.py?storageId=%s&username=%s&passwd=%s'%(dataId,username,passwd), destFullPath)def downloadItem(itemId, itemName, destPath,username,passwd):    print 'Download:%s,%s'%(itemId, itemName)    dataPath = os.path.join(destPath, itemName)    saveData(itemId, dataPath, username, passwd)def downloadStorage(itemId, itemName, destPath,username,passwd):    print 'Download:%s,%s'%(itemId, itemName)    dataPath = os.path.join(destPath, itemName)    saveData(itemId, dataPath, username, passwd)                def getStorageId(itemId, tmpPath,username,passwd, webRoot = gWebRoot):    dataPath = os.path.join(tmpPath, 'tmp.txt')    #print 'connecting:',webRoot+'/apps/tree/getItemDataId.py?treeRoot=%s&username=%s&passwd=%s'%(itemId,username,passwd)    urllib.urlretrieve(webRoot+'/apps/tree/getItemDataId.py?treeRoot=%s&username=%s&passwd=%s'%(itemId,username,passwd), dataPath)    f = open(dataPath)    a = f.read()    #print a    #print a.find('None')    if a.find('None')==0:        return None    f.close()    return a.split(' ')[0]